<Window x:Class="Launcher.Views.ScriptCardDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Launcher.ViewModels"
        xmlns:local="clr-namespace:Launcher.Views"
        mc:Ignorable="d"
        Title="{Binding Title}" 
        Height="500" 
        Width="450"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        ShowInTaskbar="False"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" 
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="8"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <!-- Object to Boolean Converter for Toggle switches -->
        <local:ObjectToBooleanConverter x:Key="ObjToBool"/>
        
        <!-- Window Control Button Style -->
        <Style x:Key="WindowControlButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource DialogTitleBarForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource DialogTitleBarHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource DialogTitleBarHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Window Close Button Style (Red on hover) -->
        <Style x:Key="WindowCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#E81123"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#F1707A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Themed ComboBox Style for dark mode support -->
        <Style x:Key="ThemedComboBoxStyle" TargetType="ComboBox">
            <Setter Property="MinHeight" Value="34"/>
            <Setter Property="Background" Value="{DynamicResource TextBoxBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource BodyForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="BackgroundBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="6"/>
                            <ContentPresenter Margin="10,0,28,0"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"/>
                            <ToggleButton x:Name="DropDownToggle"
                                          HorizontalAlignment="Right"
                                          Margin="0,0,8,0"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="Transparent">
                                            <TextBlock Text="&#xE70D;"
                                                       FontFamily="Segoe MDL2 Assets"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource BodyForegroundBrush}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <Popup x:Name="PART_Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Border Background="{DynamicResource ContentBackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Margin="0,2,0,0"
                                        MaxHeight="200">
                                    <ScrollViewer CanContentScroll="True" VerticalScrollBarVisibility="Auto">
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource SidebarHighlightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsDropDownOpen" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource SidebarHighlightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{DynamicResource BodyForegroundBrush}"/>
                        <Setter Property="Padding" Value="10,6"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource SidebarHighlightBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource SidebarHighlightBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Parameter TextBox Template -->
        <DataTemplate x:Key="TextBoxTemplate">
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="{Binding Label}" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Margin="0,0,0,4"/>
                <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                         Padding="8,6"
                         Foreground="{DynamicResource BodyForegroundBrush}"
                         Background="{DynamicResource TextBoxBackgroundBrush}"
                         BorderBrush="{DynamicResource BorderBrush}"/>
                <TextBlock Text="{Binding HelpText}" 
                           FontSize="11"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Opacity="0.6"
                           Margin="0,2,0,0"
                           Visibility="{Binding HelpText, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </DataTemplate>
        
        <!-- Parameter Dropdown Template -->
        <DataTemplate x:Key="DropdownTemplate">
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="{Binding Label}" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Margin="0,0,0,4"/>
                <ComboBox ItemsSource="{Binding Choices}"
                          SelectedItem="{Binding Value}"
                          Style="{StaticResource ThemedComboBoxStyle}"/>
            </StackPanel>
        </DataTemplate>
        
        <!-- Parameter Checkbox Template -->
        <DataTemplate x:Key="CheckboxTemplate">
            <CheckBox IsChecked="{Binding Value}"
                      Content="{Binding Label}"
                      Foreground="{DynamicResource BodyForegroundBrush}"
                      Margin="0,0,0,12"/>
        </DataTemplate>
        
        <!-- Parameter Toggle Template - Simple checkbox style -->
        <DataTemplate x:Key="ToggleTemplate">
            <CheckBox IsChecked="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource ObjToBool}}"
                      Content="{Binding Label}"
                      Foreground="{DynamicResource BodyForegroundBrush}"
                      Margin="0,0,0,12"
                      VerticalContentAlignment="Center"/>
        </DataTemplate>
        
        <!-- Parameter FilePath Template with browse button -->
        <DataTemplate x:Key="FilePathTemplate">
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="{Binding Label}" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Margin="0,0,0,4"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                             Padding="8,6"
                             Margin="0,0,4,0"
                             Foreground="{DynamicResource BodyForegroundBrush}"
                             Background="{DynamicResource TextBoxBackgroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"/>
                    <Button Grid.Column="1"
                            Content="..."
                            Padding="8,6"
                            MinWidth="34"
                            ToolTip="Browse for file"
                            Click="BrowseFile_Click"
                            Background="{DynamicResource ButtonBackgroundBrush}"
                            Foreground="{DynamicResource ButtonForegroundBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"/>
                </Grid>
            </StackPanel>
        </DataTemplate>
        
        <!-- Parameter FolderPath Template with browse button -->
        <DataTemplate x:Key="FolderPathTemplate">
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="{Binding Label}" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Margin="0,0,0,4"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0"
                             Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                             Padding="8,6"
                             Margin="0,0,4,0"
                             Foreground="{DynamicResource BodyForegroundBrush}"
                             Background="{DynamicResource TextBoxBackgroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"/>
                    <Button Grid.Column="1"
                            Content="..."
                            Padding="8,6"
                            MinWidth="34"
                            ToolTip="Browse for folder"
                            Click="BrowseFolder_Click"
                            Background="{DynamicResource ButtonBackgroundBrush}"
                            Foreground="{DynamicResource ButtonForegroundBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"/>
                </Grid>
            </StackPanel>
        </DataTemplate>
        
        <!-- Parameter Template Selector -->
        <DataTemplate DataType="{x:Type vm:ScriptCardParameter}">
            <ContentControl>
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate" Value="{StaticResource TextBoxTemplate}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsDropdown}" Value="True">
                                <Setter Property="ContentTemplate" Value="{StaticResource DropdownTemplate}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsCheckbox}" Value="True">
                                <Setter Property="ContentTemplate" Value="{StaticResource CheckboxTemplate}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsToggle}" Value="True">
                                <Setter Property="ContentTemplate" Value="{StaticResource ToggleTemplate}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsFilePath}" Value="True">
                                <Setter Property="ContentTemplate" Value="{StaticResource FilePathTemplate}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsFolderPath}" Value="True">
                                <Setter Property="ContentTemplate" Value="{StaticResource FolderPathTemplate}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
                <ContentControl.Content>
                    <Binding/>
                </ContentControl.Content>
            </ContentControl>
        </DataTemplate>
    </Window.Resources>
    
    <!-- Outer border with shadow effect for visibility -->
    <Border Margin="8" 
            Background="{DynamicResource ContentBackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8">
        <Border.Effect>
            <DropShadowEffect BlurRadius="10" 
                              ShadowDepth="2" 
                              Opacity="0.3" 
                              Color="Black"/>
        </Border.Effect>
        
        <Grid ClipToBounds="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>    <!-- Custom Title Bar -->
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="*"/>     <!-- Parameters -->
                <RowDefinition Height="Auto"/>  <!-- Output -->
                <RowDefinition Height="Auto"/>  <!-- Buttons -->
            </Grid.RowDefinitions>
            
            <!-- Custom Title Bar - Theme aware -->
            <Border Grid.Row="0" CornerRadius="7,7,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                    Background="{DynamicResource DialogTitleBarBrush}">
            <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Window Icon and Title -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="8,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="{Binding IconGlyph}" 
                           FontFamily="Segoe MDL2 Assets" 
                           FontSize="14" 
                           Foreground="{DynamicResource DialogTitleBarForegroundBrush}" 
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBlock Text="{Binding Title}" 
                           Foreground="{DynamicResource DialogTitleBarForegroundBrush}" 
                           FontSize="12"
                           VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Window Controls -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                <Button x:Name="MinimizeBtn" Click="MinimizeButton_Click" Style="{StaticResource WindowControlButtonStyle}" Content="&#xE921;" ToolTip="Minimize"/>
                <Button x:Name="MaximizeBtn" Click="MaximizeButton_Click" Style="{StaticResource WindowControlButtonStyle}" Content="&#xE922;" ToolTip="Maximize"/>
                <Button x:Name="CloseBtn" Click="CloseButton_Click" Style="{StaticResource WindowCloseButtonStyle}" Content="&#xE8BB;" ToolTip="Close"/>
            </StackPanel>
            </Grid>
            </Border>
        
        <!-- Header -->
        <Border Grid.Row="1" 
                Background="{DynamicResource SidebarBackgroundBrush}" 
                Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Icon -->
                <TextBlock Grid.Column="0"
                           Text="{Binding IconGlyph}"
                           FontFamily="Segoe MDL2 Assets"
                           FontSize="32"
                           Foreground="White"
                           VerticalAlignment="Center"
                           Margin="0,0,16,0"/>
                
                <!-- Title and Description -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Title}"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                    <TextBlock Text="{Binding Description}"
                               FontSize="12"
                               Opacity="0.8"
                               Foreground="White"
                               TextWrapping="Wrap"
                               Visibility="{Binding Description, Converter={StaticResource BoolToVis}}"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Parameters Section -->
        <ScrollViewer Grid.Row="2" 
                      VerticalScrollBarVisibility="Auto"
                      Padding="16">
            <StackPanel>
                <!-- Parameters Header -->
                <TextBlock Text="Parameters" 
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Margin="0,0,0,12"
                           Visibility="{Binding HasParameters, Converter={StaticResource BoolToVis}}"/>
                
                <!-- No Parameters Message -->
                <TextBlock Text="This script has no configurable parameters."
                           FontStyle="Italic"
                           Foreground="{DynamicResource BodyForegroundBrush}"
                           Opacity="0.6"
                           Margin="0,0,0,12"
                           Visibility="{Binding HasParameters, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"/>
                
                <!-- Parameter Controls -->
                <ItemsControl ItemsSource="{Binding Parameters}"/>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Output Section -->
        <Expander Grid.Row="3" 
                  Header="Output"
                  IsExpanded="{Binding HasOutput, Mode=OneWay}"
                  Padding="16,8"
                  Visibility="{Binding HasOutput, Converter={StaticResource BoolToVis}}">
            <Border Background="#1E1E1E" 
                    CornerRadius="4" 
                    Padding="8"
                    MaxHeight="200">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <ScrollViewer Grid.Row="0" 
                                  VerticalScrollBarVisibility="Auto"
                                  MaxHeight="180"
                                  x:Name="OutputScrollViewer">
                        <TextBox Text="{Binding OutputText, Mode=OneWay}"
                                 FontFamily="Cascadia Code, Consolas, monospace"
                                 FontSize="11"
                                 Foreground="#D4D4D4"
                                 IsReadOnly="True"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Disabled"/>
                    </ScrollViewer>
                    
                    <!-- Progress Bar -->
                    <ProgressBar Grid.Row="1"
                                 Value="{Binding Progress}"
                                 Maximum="100"
                                 Height="4"
                                 Margin="0,8,0,0"
                                 Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}"/>
                </Grid>
            </Border>
        </Expander>
        
        <!-- Error Message -->
        <Border Grid.Row="3"
                Background="#FFEBEE"
                BorderBrush="#F44336"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12"
                Margin="16,8"
                Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="❌" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding ErrorMessage}" 
                           Foreground="#C62828"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>
        
        <!-- Action Buttons -->
        <Border Grid.Row="4" 
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Status indicator -->
                <StackPanel Grid.Column="0" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center">
                    <!-- Running spinner -->
                    <TextBlock Text="&#xE895;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="16"
                               Margin="0,0,8,0"
                               Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotation" CenterX="8" CenterY="8"/>
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation 
                                            Storyboard.TargetProperty="(TextBlock.RenderTransform).(RotateTransform.Angle)"
                                            From="0" To="360" Duration="0:0:1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                    <TextBlock Text="Running..." 
                               Foreground="{DynamicResource BodyForegroundBrush}"
                               VerticalAlignment="Center"
                               Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}"/>
                    
                    <!-- Success indicator -->
                    <TextBlock Text="✓ Completed"
                               Foreground="#4CAF50"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               Visibility="{Binding IsSuccess, Converter={StaticResource BoolToVis}}"/>
                </StackPanel>
                
                <!-- Cancel Button -->
                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Padding="16,8"
                        Margin="0,0,8,0"
                        Visibility="{Binding IsRunning, Converter={StaticResource BoolToVis}}"/>
                
                <!-- Close Button (when not running) - matches PrimaryButtonStyle -->
                <Button Grid.Column="1"
                        Click="CloseButton_Click"
                        Padding="16,10"
                        Margin="0,0,8,0"
                        MinWidth="90"
                        MinHeight="36"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        Visibility="{Binding CanRun, Converter={StaticResource BoolToVis}}">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource ButtonForegroundBrush}"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="ButtonBorder" 
                                                Background="{TemplateBinding Background}" 
                                                CornerRadius="6">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"
                                                            Margin="{TemplateBinding Padding}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Close" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                
                <!-- Execute Button - matches PrimaryButtonStyle with accent color -->
                <Button Grid.Column="2"
                        Command="{Binding ExecuteCommand}"
                        Padding="16,10"
                        MinWidth="100"
                        MinHeight="36"
                        FontWeight="SemiBold"
                        Cursor="Hand"
                        IsEnabled="{Binding CanRun}">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#0078D4"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="ButtonBorder" 
                                                Background="{TemplateBinding Background}" 
                                                CornerRadius="6">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"
                                                            Margin="{TemplateBinding Padding}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="ButtonBorder" Property="Background" Value="#1084D8"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter TargetName="ButtonBorder" Property="Background" Value="#404040"/>
                                                <Setter Property="Opacity" Value="0.6"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ActionLabel}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
        </Grid>
    </Border>
</Window>


